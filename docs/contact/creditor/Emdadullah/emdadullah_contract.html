<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contract & Compensation — Qari Emdadullah</title>

  <!--
    Quoted from the uploaded contract record:
    "Unlock with the investor's ID number to view the full contract, live counters, and compensation calculations."
    "Payment received in cash Tk. 13,000 on 2025-09-08 at the investor's residence main gate (approx. 21:00 BST)."
    (Source: uploaded contract record)
  -->

  <style>
    :root{
      --bg: #f6f8fb;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #0f172a;
      --accent-2: #0ea5a4;
      --danger: #ef4444;
      --success: #10b981;
      --shadow: 0 10px 30px rgba(2,6,23,0.06);
      --mono: "Courier New", Courier, monospace;
      --radius: 12px;
      --glass: rgba(255,255,255,0.6);
      --surface-border: rgba(2,6,23,0.03);
      --muted-contrast: rgba(15,23,42,0.04);
    }

    /* Reset / base */
    * { box-sizing: border-box; }
    html,body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(180deg, #eef2ff 0%, var(--bg) 100%);
      color: var(--accent);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      line-height: 1.45;
      -webkit-text-size-adjust: 100%;
    }

    /* Header */
    header {
      background: linear-gradient(90deg, #0b1220, #1f2937);
      color: #fff;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      position: sticky;
      top: 0;
      z-index: 50;
      box-shadow: 0 6px 18px rgba(15,23,42,0.08);
    }
    .brand { display: flex; gap: 12px; align-items: center; }
    .logo img { width: 48px; height: 48px; border-radius: 10px; object-fit: cover; display: block; }
    header h1 { font-size: 18px; margin: 0; font-weight: 700; color: #fff; }
    nav ul { list-style: none; margin: 0; padding: 0; display: flex; gap: 12px; align-items: center; }
    nav a { color: rgba(255,255,255,0.95); text-decoration: none; font-weight: 600; font-size: 13px; }

    /* Layout */
    .wrap { max-width: 1100px; margin: 22px auto; padding: 0 18px; }
    .grid {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 18px;
      align-items: start;
    }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid var(--surface-border);
    }
    h2 { margin: 0 0 10px 0; font-size: 18px; color: var(--accent); }
    .lead { color: var(--muted); font-size: 14px; margin-bottom: 12px; }

    /* Access / controls */
    .access {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .access input[type="password"],
    .access input[type="text"] {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #e6e9ef;
      background: #fbfdff;
      width: 240px;
      font-size: 14px;
      color: var(--accent);
    }
    .access button {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
    }
    .hint { font-size: 13px; color: var(--muted); }

    /* Clocks / counters */
    .clocks { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
    .clock-card {
      flex: 1 1 220px;
      background: linear-gradient(180deg,#fff,#fbfdff);
      border-radius: 10px;
      padding: 12px;
      border: 1px solid var(--surface-border);
      box-shadow: 0 6px 18px rgba(2,6,23,0.04);
      min-width: 180px;
    }
    .clock-card h4 { margin: 0; font-size: 13px; color: var(--muted); }
    .clock-card .big { font-weight: 800; color: var(--accent-2); font-size: 16px; }
    .count-large { font-weight: 800; font-size: 15px; color: #0b1220; }

    /* Table / ledger */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      margin-top: 12px;
      background: transparent;
    }
    thead th {
      text-align: left;
      padding: 12px 10px;
      background: linear-gradient(90deg,#eef2ff,#f8fafc);
      color: #0f172a;
      font-weight: 700;
      border-bottom: 2px solid var(--muted-contrast);
      font-size: 13px;
    }
    tbody td {
      padding: 12px 10px;
      border-bottom: 1px dashed var(--muted-contrast);
      vertical-align: middle;
    }
    tbody tr:nth-child(even) { background: rgba(15,23,42,0.02); }
    .mono { font-family: var(--mono); color: #0b1220; }

    /* Summary tiles */
    .summary { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
    .tile {
      flex: 1 1 160px;
      background: linear-gradient(180deg,#fff,#fbfdff);
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.04);
      border: 1px solid var(--surface-border);
    }
    .tile .label { font-size: 13px; color: var(--muted); margin-bottom: 6px; font-weight: 600; }
    .tile .value { font-size: 18px; font-weight: 800; color: #0f172a; }

    /* Side / info */
    .side { display: flex; flex-direction: column; gap: 12px; }
    .info-card {
      padding: 12px;
      border-radius: 10px;
      background: linear-gradient(180deg,#fff,#fbfdff);
      box-shadow: var(--shadow);
      border: 1px solid var(--surface-border);
    }
    .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed var(--muted-contrast); }
    .info-row:last-child { border-bottom: 0; }
    .info-row .k { color: var(--muted); font-weight: 700; }
    .info-row .v { font-weight: 700; color: #0f172a; }

    /* Actions */
    .actions { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    .actions button {
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(2,6,23,0.06);
      background: #fff;
      cursor: pointer;
    }

    /* Contract text */
    .contract { font-size: 14px; color: #0f172a; margin-top: 12px; }
    .contract h3 { margin: 12px 0 6px 0; font-size: 15px; color: var(--accent); }
    .contract p { margin: 6px 0; color: var(--muted); }
    .signature { margin-top: 18px; display: flex; gap: 18px; flex-wrap: wrap; }
    .sig-box {
      flex: 1 1 220px;
      padding: 12px;
      border-radius: 8px;
      border: 1px dashed var(--muted-contrast);
      background: #fff;
    }

    /* Compensation UI */
    .comp-card {
      margin-top: 14px;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--surface-border);
      background: linear-gradient(180deg,#fff,#fbfdff);
    }
    .comp-row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .comp-row label { font-size: 13px; color: var(--muted); min-width: 160px; }
    .comp-row input[type="number"],
    .comp-row select {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #e6e9ef;
      background: #fff;
    }
    .comp-result {
      margin-top: 12px;
      padding: 12px;
      border-radius: 8px;
      background: #f8fafc;
      border: 1px solid rgba(2,6,23,0.03);
    }

    /* Highlighted result lines */
    .comp-result-line { margin-top: 6px; padding: 8px; border-radius: 6px; display: block; }
    .comp-status { background: #fff3cd; color: #856404; font-weight: 700; }
    .comp-elapsed { background: #f8d7da; color: #721c24; font-weight: 700; }
    .comp-amount { background: #d1ecf1; color: #0c5460; font-weight: 700; }
    .comp-total { background: #d4edda; color: #155724; font-weight: 700; }

    /* Contact / footer message */
    .contact-box {
      margin-top: 20px;
      padding: 14px;
      border-radius: 10px;
      background: linear-gradient(180deg,#fff,#fbfdff);
      border: 1px solid rgba(2,6,23,0.06);
      box-shadow: 0 6px 18px rgba(2,6,23,0.04);
      font-size: 14px;
      color: #0f172a;
    }
    .contact-box strong { color: var(--danger); }
    .mj-message {
      margin-top: 12px;
      font-style: italic;
      color: #0f172a;
      background: #f0f4f8;
      padding: 10px;
      border-radius: 8px;
      border-left: 4px solid var(--accent-2);
    }

    /* Responsive adjustments */
    @media (max-width: 980px) {
      .grid { grid-template-columns: 1fr; padding-bottom: 80px; }
      .access input[type="password"] { width: 100%; }
      .clock-card { flex: 1 1 100%; }
      .tile { flex: 1 1 48%; }
      .sig-box { flex: 1 1 100%; }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo"><img src="docs/assets/logo.png" alt="Logo"></div>
      <div>
        <h1>Contract & Compensation — Qari Emdadullah</h1>
        <div style="font-size:12px;color:rgba(255,255,255,0.85);margin-top:4px">Live counters and automatic compensation calculator</div>
      </div>
    </div>
    <nav>
      <ul>
        <li><a href="#" style="color:#fff">Home</a></li>
        <li><a href="#" style="color:#fff">Contracts</a></li>
        <li><a href="#" style="color:#fff">Help</a></li>
      </ul>
    </nav>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- Left column -->
      <section class="card" aria-labelledby="contractTitle">
        <h2 id="contractTitle">Agreement Record — Qari Emdadullah</h2>
        <div class="lead">Unlock with the investor's ID number to view the full contract, live counters, and compensation calculations.</div>

        <div class="access">
          <input id="credential" type="password" placeholder="Enter password (ID number)" aria-label="Credential input" />
          <button id="unlockBtn">Unlock</button>
          <div class="hint">Password (ID): <strong>1820096806</strong></div>
        </div>

        <div id="accessMessage" style="display:none;margin-top:8px;font-size:13px;color:var(--danger);font-weight:700"></div>

        <!-- Clocks -->
        <div class="clocks">
          <div class="clock-card">
            <h4>Bangladesh Time BST</h4>
            <div id="bdTime" class="big">—</div>
            <div style="font-size:12px;color:var(--muted)">Real-time Asia/Dhaka</div>
          </div>

          <div class="clock-card">
            <h4>Countdown to Earliest Delivery</h4>
            <div id="countdownToEarliest" class="count-large">—</div>
            <div style="font-size:12px;color:var(--muted)">Counts down to 45 days after payment</div>
          </div>

          <div class="clock-card">
            <h4>Elapsed Since Maximum Delivery</h4>
            <div id="elapsedSinceMax" class="count-large">—</div>
            <div style="font-size:12px;color:var(--muted)">Counts up after 60 days</div>
          </div>
        </div>

        <!-- Contract area (hidden until unlock) -->
        <div id="contractArea" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-top:12px">
            <div>
              <div style="font-weight:800;font-size:16px">Qari Emdadullah</div>
              <div style="color:var(--muted);font-size:13px;margin-top:4px">Investor • Short term (2 months from Sep 08, 2025)</div>
            </div>
            <div style="text-align:right;color:var(--muted);font-size:13px">
              <div><strong>Last update</strong></div>
              <div id="lastUpdate" style="font-weight:700;margin-top:6px">Wednesday, February 25, 2026 2:39:56 PM</div>
            </div>
          </div>

          <div class="contract">
            <h3>Parties and Payment</h3>
            <p><strong>Investor:</strong> Qari Emdadullah — 11/11/b KM Das Lane, Wari, Sutrapur, Dhaka-1203. Phone: <strong>+880-1820-096806</strong>.</p>
            <p><strong>Recipient:</strong> (You / your organization). Payment received in cash Tk. <strong>13,000</strong> on <strong>2025-09-08</strong> at the investor's residence main gate (approx. 21:00 BST).</p>

            <h3>Agreement Summary</h3>
            <p>The recipient agreed to deliver <strong>65 copies</strong> of printed Quran Majid in exchange for Tk.13,000. Delivery window: earliest <strong>45 days</strong> and maximum <strong>60 days</strong> from the payment date.</p>

            <h3>Delivery Dates</h3>
            <p><strong>Payment start:</strong> <span id="startDateText">2025-09-08 21:00:00 (BST)</span></p>
            <p><strong>Earliest due (45 days):</strong> <span id="earliestDateText"></span></p>
            <p><strong>Maximum due (60 days):</strong> <span id="maxDateText"></span></p>

            <h3>Compensation Rules</h3>
            <p>If delivery is not completed by the maximum due date, compensation becomes active. Two calculation modes are provided below. The page computes compensation in real time based on elapsed time since the maximum due date.</p>

            <!-- Compensation UI -->
            <div class="comp-card">
              <div style="font-weight:700">Compensation Calculator</div>

              <div class="comp-row">
                <label>Principal amount Tk</label>
                <b>Tk.13000.00 BDT</b>
              </div>

              <div class="comp-row">
                <label>Calculation mode</label>
                  <option value="daily">
                  <b>Daily fixed penalty</b>
                  </option>
              </div>

              <div id="dailyRow" class="comp-row">
                <label>Penalty per day Tk</label>
                <input id="penaltyPerDay" type="number" value="100" min="0" />
                <div style="font-size:13px;color:var(--muted)"></div>
              </div>




              <div class="comp-row">
                <b>Status: <span id="compStatus">Waiting for max date</span></b>
              </div>Elapsed since max: 
              <div class="comp-result-line comp-elapsed">
                <span id="compElapsed">—</span>
              </div>
              <div class="comp-result-line comp-amount">
                Calculated compensation:<span id="compAmount">Tk. 0</span>
              </div>
              <div class="comp-result-line comp-total">
                <strong>Total owed (principal + com.): <span id="totalOwed">Tk. 0</span></strong>
              </div>
            </div>

            <h3 style="margin-top:12px">Remedies and Evidence</h3>
            <p>This record timestamps the payment and running counters. For enforceability, parties should sign a written contract and keep witnesses or notarization. The compensation computed here is a suggested remedy; parties may agree on a different formula.</p>

            <h3 style="margin-top:12px">Signatures</h3>
            <div class="signature">
              <div class="sig-box">
                <div style="font-weight:700">Investor</div>
                <div style="color:var(--muted);font-size:13px;margin-top:8px">Name: Qari Emdadullah</div>
                <div style="color:var(--muted);font-size:13px;margin-top:6px">Signature: ____________________</div>
                <div style="color:var(--muted);font-size:12px;margin-top:6px">Date: ____________________</div>
              </div>
              <div class="sig-box">
                <div style="font-weight:700">Recipient</div>
                <div style="color:var(--muted);font-size:13px;margin-top:8px">Name: (Your name)</div>
                <div style="color:var(--muted);font-size:13px;margin-top:6px">Signature: ____________________</div>
                <div style="color:var(--muted);font-size:12px;margin-top:6px">Date: ____________________</div>
              </div>
            </div>
          </div>

          <!-- Transaction ledger -->
          <h3 style="margin-top:14px">Transaction Ledger</h3>
          <table class="mono">
            <thead>
              <tr>
                <th>Date & Time</th>
                <th>Amount (Tk)</th>
                <th>Method</th>
                <th>Mobile</th>
                <th>Transaction ID</th>
              </tr>
            </thead>
            <tbody id="txBody"></tbody>
          </table>

          <div class="summary">
            <div class="tile">
              <div class="label">Total Bkash</div>
              <div class="value" id="totalBkash">Tk. 0</div>
            </div>
            <div class="tile">
              <div class="label">Total Cash</div>
              <div class="value" id="totalCash">Tk. 0</div>
            </div>
            <div class="tile">
              <div class="label">Grand Total</div>
              <div class="value" id="grandTotal">Tk. 0</div>
            </div>
          </div>

          <div class="actions">
            <button id="copySummary">Copy Summary</button>
            <button id="downloadCsv">Download CSV</button>
            <button id="printBtn">Print</button>
          </div>
        </div>
      </section>

      <!-- Right column -->
      <aside class="side">
        <div class="info-card card">
          <h3 style="margin:0 0 8px 0">Investor Info</h3>
          <div class="info-row"><div class="k">Full name</div><div class="v">Qari Emdadullah</div></div>
          <div class="info-row"><div class="k">Address</div><div class="v">11/11/b KM Das Lane, Wari, Sutrapur, Dhaka-1203</div></div>
          <div class="info-row"><div class="k">Email</div><div class="v">hizbullahsalem@gmail.com</div></div>
          <div class="info-row"><div class="k">Phone</div><div class="v">+880-1820-096806</div></div>
          <div style="margin-top:10px;font-size:13px;color:var(--muted)"><strong>Agreement</strong></div>
          <div style="margin-top:6px;font-size:13px;color:var(--muted)">Short-term investment: 2 months from Sep 08, 2025</div>
        </div>

        <div class="info-card card">
          <h3 style="margin:0 0 8px 0">Quick Actions</h3>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <button id="copySummarySide" style="padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);background:#fff;cursor:pointer">Copy Summary</button>
            <button id="downloadCsvSide" style="padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);background:#fff;cursor:pointer">Download CSV</button>
            <button id="printBtnSide" style="padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);background:#fff;cursor:pointer">Print</button>
          </div>
        </div>

        <div class="info-card card">
          <h3 style="margin:0 0 8px 0">Guidance</h3>
          <div style="color:var(--muted);font-size:13px">For legal enforceability, sign a written contract with witnesses or notarization. This page provides transparent timestamps and calculations for accountability.</div>
        </div>
      </aside>
    </div>

    <!-- Compensation Result Box -->
    <div class="comp-result" id="compResult" style="margin-top:18px">
      <div class="comp-result-line comp-status"><strong>Status:</strong> <span id="compStatus">Waiting for max date</span></div>
      <div class="comp-result-line comp-elapsed"><strong>Elapsed since max:</strong> <span id="compElapsed">—</span></div>
      <div class="comp-result-line comp-amount"><strong>Calculated compensation:</strong> <span id="compAmount">Tk. 0</span></div>
      <div class="comp-result-line comp-total"><strong>Total owed (principal + compensation):</strong> <span id="totalOwed">Tk. 0</span></div>
    </div>

    <!-- Contact Section -->
    <div class="contact-box">
      <p>If you need to <strong>change the password</strong> or have any questions, please contact: <strong>quranerfariwala@gmail.com</strong></p>
      <div class="mj-message">
        “MJ Ahmad remains deeply grateful yet ashamed, and commits with sincerity that every moment of delay will be accounted for until the investor’s rightful benefit is fulfilled.”
      </div>
    </div>

    <footer>
      <div style="max-width:1100px;margin:18px auto;padding:8px 20px;color:var(--muted)">
        &copy; 2026 mj.dev • Contract & Compensation • All rights reserved
      </div>
    </footer>
  </main>

  <script>
    /* -------------------------
       Data
       ------------------------- */
    const transactions = [
      { dt: "2025-09-08 21:00:00", amount: 13000, method: "Cash", mobile: "", trx: "" }
    ];

    /* -------------------------
       Elements
       ------------------------- */
    const credentialInput = document.getElementById("credential");
    const unlockBtn = document.getElementById("unlockBtn");
    const accessMessage = document.getElementById("accessMessage");
    const contractArea = document.getElementById("contractArea");
    const bdTimeEl = document.getElementById("bdTime");
    const countdownToEarliestEl = document.getElementById("countdownToEarliest");
    const elapsedSinceMaxEl = document.getElementById("elapsedSinceMax");
    const txBody = document.getElementById("txBody");
    const totalBkashEl = document.getElementById("totalBkash");
    const totalCashEl = document.getElementById("totalCash");
    const grandTotalEl = document.getElementById("grandTotal");

    const principalInput = document.getElementById("principal");
    const modeSelect = document.getElementById("mode");
    const penaltyPerDayInput = document.getElementById("penaltyPerDay");
    const monthlyPercentInput = document.getElementById("monthlyPercent");
    const roundingSelect = document.getElementById("rounding");

    const compStatusEl = document.getElementById("compStatus");
    const compElapsedEl = document.getElementById("compElapsed");
    const compAmountEl = document.getElementById("compAmount");
    const totalOwedEl = document.getElementById("totalOwed");

    const copySummaryBtn = document.getElementById("copySummary");
    const copySummarySideBtn = document.getElementById("copySummarySide");
    const downloadCsvBtn = document.getElementById("downloadCsv");
    const downloadCsvSideBtn = document.getElementById("downloadCsvSide");
    const printBtn = document.getElementById("printBtn");
    const printBtnSide = document.getElementById("printBtnSide");

    /* -------------------------
       Constants
       ------------------------- */
    const VALID_PASSWORD = "1820096806";
    const START_ISO = "2025-09-08T21:00:00+06:00";
    const startDate = new Date(START_ISO);
    const earliestDate = addDays(startDate, 45);
    const maxDate = addDays(startDate, 60);

    /* -------------------------
       Utilities
       ------------------------- */
    function addDays(date, days) {
      const d = new Date(date.getTime());
      d.setDate(d.getDate() + days);
      return d;
    }
    function pad(n) { return String(n).padStart(2, "0"); }
    function formatNumber(n) { return Number(n).toLocaleString("en-US"); }
    function formatLocalBD(d) {
      const opts = {
        year: "numeric", month: "short", day: "numeric",
        hour: "2-digit", minute: "2-digit", second: "2-digit",
        hour12: false, timeZone: "Asia/Dhaka"
      };
      return new Date(d.toLocaleString("en-US", { timeZone: "Asia/Dhaka" })).toLocaleString("en-GB", opts).replace(",", "");
    }

    /* -------------------------
       Access control
       ------------------------- */
    unlockBtn.addEventListener("click", tryUnlock);
    credentialInput.addEventListener("keydown", (e) => { if (e.key === "Enter") tryUnlock(); });

    function tryUnlock() {
      const v = (credentialInput.value || "").trim();
      if (!v) return showAccess("Please enter the password (ID number).");
      if (v === VALID_PASSWORD) {
        accessMessage.style.display = "none";
        revealContract();
      } else {
        showAccess("Access Denied — incorrect password.");
      }
    }
    function showAccess(msg) {
      accessMessage.style.display = "block";
      accessMessage.textContent = msg;
      contractArea.style.display = "none";
    }

    /* -------------------------
       Render transactions & totals
       ------------------------- */
    function renderTransactions() {
      txBody.innerHTML = "";
      const totals = { Bkash: 0, Cash: 0 };
      transactions.forEach(tx => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="mono">${tx.dt}</td>
          <td class="mono">Tk. ${formatNumber(tx.amount)}</td>
          <td>${tx.method}</td>
          <td class="mono">${tx.mobile || "-"}</td>
          <td class="mono">${tx.trx || "-"}</td>
        `;
        txBody.appendChild(tr);
        if (tx.method === "Bkash") totals.Bkash += tx.amount;
        else if (tx.method === "Cash") totals.Cash += tx.amount;
      });
      const grand = totals.Bkash + totals.Cash;
      totalBkashEl.textContent = `Tk. ${formatNumber(totals.Bkash)}`;
      totalCashEl.textContent = `Tk. ${formatNumber(totals.Cash)}`;
      grandTotalEl.textContent = `Tk. ${formatNumber(grand)}`;
    }

    /* -------------------------
       Reveal contract
       ------------------------- */
    function revealContract() {
      renderTransactions();
      contractArea.style.display = "block";
      contractArea.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    /* -------------------------
       Real-time Bangladesh clock
       ------------------------- */
    function updateBDTime() {
      const now = new Date();
      const bd = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Dhaka" }));
      const opts = {
        weekday: "short", year: "numeric", month: "short", day: "numeric",
        hour: "2-digit", minute: "2-digit", second: "2-digit", hour12: false, timeZone: "Asia/Dhaka"
      };
      if (bdTimeEl) bdTimeEl.textContent = bd.toLocaleString("en-GB", opts).replace(",", "");
    }

    /* -------------------------
       Detailed diff (months/weeks/days/h:m:s)
       ------------------------- */
    function computeDetailedDiff(fromDate, toDate) {
      let start = new Date(fromDate);
      let end = new Date(toDate);
      if (end < start) [start, end] = [end, start];

      const yearsDiff = end.getFullYear() - start.getFullYear();
      let monthsDiff = end.getMonth() - start.getMonth() + yearsDiff * 12;

      const addMonths = (d, m) => {
        const nd = new Date(d.getTime());
        const y = nd.getFullYear();
        const mo = nd.getMonth();
        nd.setFullYear(y + Math.floor((mo + m) / 12));
        nd.setMonth((mo + m) % 12);
        return nd;
      };

      let months = monthsDiff;
      while (months > 0 && addMonths(start, months) > end) months--;
      const afterMonths = addMonths(start, months);
      let remainderMs = end - afterMonths;
      const sec = Math.floor(remainderMs / 1000);
      const weeks = Math.floor(sec / (7 * 24 * 3600));
      const days = Math.floor((sec % (7 * 24 * 3600)) / (24 * 3600));
      const hours = Math.floor((sec % (24 * 3600)) / 3600);
      const minutes = Math.floor((sec % 3600) / 60);
      const seconds = sec % 60;

      return { months, weeks, days, hours, minutes, seconds };
    }

    /* -------------------------
       Countdown & elapsed updater
       ------------------------- */
    function updateCountdowns() {
      const nowBD = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Dhaka" }));

      // Countdown to earliest
      const diffEarliest = earliestDate - nowBD;
      if (diffEarliest > 0) {
        const totalSec = Math.floor(diffEarliest / 1000);
        const days = Math.floor(totalSec / (24 * 3600));
        const hours = Math.floor((totalSec % (24 * 3600)) / 3600);
        const minutes = Math.floor((totalSec % 3600) / 60);
        const seconds = totalSec % 60;
        if (countdownToEarliestEl) countdownToEarliestEl.textContent = `${days}d ${pad(hours)}h ${pad(minutes)}m ${pad(seconds)}s`;
      } else {
        if (countdownToEarliestEl) countdownToEarliestEl.textContent = `Earliest delivery window reached`;
      }

      // Elapsed since max
      const diffMax = nowBD - maxDate;
      if (diffMax < 0) {
        if (elapsedSinceMaxEl) elapsedSinceMaxEl.textContent = `Not yet passed`;
      } else {
        const diff = computeDetailedDiff(maxDate, nowBD);
        if (elapsedSinceMaxEl) elapsedSinceMaxEl.textContent = `${diff.months}m ${diff.weeks}w ${diff.days}d ${pad(diff.hours)}h ${pad(diff.minutes)}m ${pad(diff.seconds)}s`;
      }

      // update compensation live
      updateCompensation(nowBD);
    }

    /* -------------------------
       Compensation calculator
       ------------------------- */
    function applyRounding(value) {
      const mode = roundingSelect ? roundingSelect.value : "none";
      if (mode === "ceil") return Math.ceil(value);
      if (mode === "floor") return Math.floor(value);
      return Number(value);
    }

    function updateCompensation(nowBD) {
      const principal = principalInput ? Number(principalInput.value) || 0 : 0;

      if (!compStatusEl || !compElapsedEl || !compAmountEl || !totalOwedEl) return;

      if (nowBD < maxDate) {
        compStatusEl.textContent = "Maximum delivery date not yet passed";
        compElapsedEl.textContent = "0m 0w 0d 00h 00m 00s";
        compAmountEl.textContent = `Tk. 0`;
        totalOwedEl.textContent = `Tk. ${formatNumber(principal)}`;
        return;
      }

      const diff = computeDetailedDiff(maxDate, nowBD);
      compElapsedEl.textContent = `${diff.months}m ${diff.weeks}w ${diff.days}d ${pad(diff.hours)}h ${pad(diff.minutes)}m ${pad(diff.seconds)}s`;
      compStatusEl.textContent = "Maximum delivery passed — compensation active";

      let comp = 0;
      const mode = modeSelect ? modeSelect.value : "daily";

      if (mode === "daily") {
        const msElapsed = nowBD - maxDate;
        const daysFloat = msElapsed / (1000 * 60 * 60 * 24);
        const perDay = penaltyPerDayInput ? Number(penaltyPerDayInput.value) || 0 : 0;
        comp = daysFloat * perDay;
      } else if (mode === "monthly") {
        const monthsWhole = diff.months;
        const afterMonths = (() => {
          const nd = new Date(maxDate.getTime());
          nd.setMonth(nd.getMonth() + monthsWhole);
          return nd;
        })();
        const remainderMs = nowBD - afterMonths;
        const daysInMonthApprox = 30;
        const remainderMonths = remainderMs / (1000 * 60 * 60 * 24 * daysInMonthApprox);
        const totalMonths = monthsWhole + remainderMonths;
        const monthlyPercent = monthlyPercentInput ? Number(monthlyPercentInput.value) || 0 : 0;
        comp = principal * (monthlyPercent / 100) * totalMonths;
      }

      const compRounded = applyRounding(comp);
      const total = applyRounding(principal + compRounded);

      compAmountEl.textContent = `Tk. ${formatNumber(compRounded)}`;
      totalOwedEl.textContent = `Tk. ${formatNumber(total)}`;
    }

    /* UI toggles */
    if (modeSelect) {
      modeSelect.addEventListener("change", () => {
        const mode = modeSelect.value;
        const dailyRow = document.getElementById("dailyRow");
        const monthlyRow = document.getElementById("monthlyRow");
        if (dailyRow) dailyRow.style.display = mode === "daily" ? "flex" : "none";
        if (monthlyRow) monthlyRow.style.display = mode === "monthly" ? "flex" : "none";
      });
    }

    /* update on input changes */
    [principalInput, penaltyPerDayInput, monthlyPercentInput, roundingSelect].forEach(el => {
      if (!el) return;
      el.addEventListener("input", () => updateCompensation(new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Dhaka" }))));
    });

    /* -------------------------
       Quick actions
       ------------------------- */
    function copySummary() {
      const summary = [
        "Agreement — Qari Emdadullah",
        "Payment: Tk. 13,000 (Cash) on " + formatLocalBD(startDate),
        "Earliest delivery due: " + formatLocalBD(earliestDate),
        "Maximum delivery due: " + formatLocalBD(maxDate),
        "Compensation (live): " + (compAmountEl ? compAmountEl.textContent : "Tk. 0"),
        "Total owed (live): " + (totalOwedEl ? totalOwedEl.textContent : "Tk. 0")
      ].join("\n");
      navigator.clipboard?.writeText(summary).then(() => { alert("Summary copied to clipboard."); }).catch(() => { alert("Unable to copy."); });
    }

    function downloadCsv() {
      const headers = ["Date & Time", "Amount (Tk)", "Method", "Mobile", "Transaction ID"];
      const rows = transactions.map(t => [t.dt, t.amount, t.method, t.mobile || "-", t.trx || "-"]);
      const csv = [headers, ...rows].map(r => r.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(",")).join("\n");
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "emdadullah_statement.csv";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    if (copySummaryBtn) copySummaryBtn.addEventListener("click", copySummary);
    if (copySummarySideBtn) copySummarySideBtn.addEventListener("click", copySummary);
    if (downloadCsvBtn) downloadCsvBtn.addEventListener("click", downloadCsv);
    if (downloadCsvSideBtn) downloadCsvSideBtn.addEventListener("click", downloadCsv);
    if (printBtn) printBtn.addEventListener("click", () => window.print());
    if (printBtnSide) printBtnSide.addEventListener("click", () => window.print());

    /* -------------------------
       Start intervals
       ------------------------- */
    // Initialize displayed dates
    document.getElementById('startDateText').textContent = formatLocalBD(startDate) + " (BST)";
    document.getElementById('earliestDateText').textContent = formatLocalBD(earliestDate) + " (BST)";
    document.getElementById('maxDateText').textContent = formatLocalBD(maxDate) + " (BST)";

    updateBDTime();
    updateCountdowns();
    setInterval(updateBDTime, 1000);
    setInterval(updateCountdowns, 1000);

    /* Optional: prefill credential for convenience (comment out in production) */
    // credentialInput.value = VALID_PASSWORD;
  </script>
</body>
</html>
